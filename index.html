
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥ v2.5</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;touch-action:manipulation;}
        body {font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f8e1e9 0%,#e8f4f8 50%,#fff1f5 100%);min-height:100vh;padding:15px 10px;padding-bottom:env(safe-area-inset-bottom);}
        .container {max-width:100%;background:rgba(255,255,255,0.97);border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,0.15);overflow:hidden;}
        .header {background:linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);color:white;padding:25px 20px;text-align:center;}
        .header h1 {font-size:clamp(1.8em,5vw,2.5em);margin:0;text-shadow:0 2px 4px rgba(0,0,0,0.2);}
        .content {padding:25px 20px;}

        .btn-grid {display:block;}
        .btn {width:100%;padding:20px;background:linear-gradient(135deg,#a8e6cf 0%,#88d8a3 100%);color:#333;border:none;border-radius:20px;font-size:clamp(16px,4.5vw,20px);font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 10px 25px rgba(168,230,207,0.4);margin:15px 0;}
        .btn:active {transform:scale(0.97);}

        .client-list {background:white;border-radius:20px;padding:0;box-shadow:0 10px 25px rgba(0,0,0,0.1);}
        .client-card {padding:25px;border-bottom:1px solid #f5f5f5;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:20px;border-radius:20px;margin:0 20px 10px 20px;overflow:hidden;}
        .client-card:last-child {border-bottom:none;margin-bottom:20px;}
        .client-card:active {background:#fff5f5;transform:translateX(5px);}
        .client-avatar {width:70px;height:70px;border-radius:50%;border:4px solid #ff9a9e;background:linear-gradient(135deg,#ff9a9e,#fecfef);display:flex;align-items:center;justify-content:center;color:white;font-size:28px;flex-shrink:0;}
        .client-info {flex:1;}
        .client-name {font-size:clamp(18px,5vw,22px);font-weight:bold;color:#333;margin-bottom:5px;}
        .client-phone {color:#666;font-size:clamp(14px,4vw,16px);}
        .client-visits {color:#a8e6cf;font-weight:500;font-size:clamp(14px,3.5vw,16px);}
        .no-clients {text-align:center;padding:60px 20px;color:#999;}
        .no-clients h3 {font-size:clamp(18px,5vw,24px);margin-bottom:20px;color:#ff9a9e;}

        /* ‚úÖ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –£–ë–†–ê–ù–ê */
        #loginForm {display:none !important;} /* –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ª–æ–≥–∏–Ω–∞ */

        .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;padding:20px 0;}
        .modal-content {position:relative;margin:auto;max-width:95%;max-height:95%;background:white;border-radius:25px;padding:35px 30px;overflow-y:auto;max-height:90vh;animation:modalSlide 0.3s;}
        @keyframes modalSlide {from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
        .close {position:absolute;top:15px;right:20px;font-size:36px;cursor:pointer;color:#999;width:50px;height:50px;display:flex;align-items:center;justify-content:center;}
        .close:active {color:#ff6b81;}

        .form-row {display:grid;grid-template-columns:1fr;gap:20px;}
        @media (min-width:600px) {.form-row {grid-template-columns:1fr 1fr;}}
        .form-group {margin-bottom:25px;}
        .form-group label {display:block;margin-bottom:12px;color:#555;font-weight:500;font-size:clamp(15px,3.8vw,17px);}
        .form-group input, .form-group textarea {width:100%;padding:20px;border:2px solid #e1e1e1;border-radius:20px;font-size:clamp(16px,4vw,18px);background:#fafafa;min-height:55px;transition:all 0.3s;}
        .form-group input:focus, .form-group textarea:focus {border-color:#a8e6cf;background:white;box-shadow:0 0 0 4px rgba(168,230,207,0.2);}
        .form-group textarea {min-height:120px;}

        .new-item-section {background:#fff5f8;border:2px dashed #ff9a9e;padding:15px;border-radius:15px;margin-top:15px;}
        .new-input-row {display:flex;gap:15px;align-items:end;}
        .new-input-row input {flex:1;}

        .photo-preview {max-width:100%;height:200px;border-radius:20px;margin:15px 0;box-shadow:0 10px 30px rgba(0,0,0,0.2);object-fit:cover;}

        .visit-item {background:#f9f9f9;padding:25px;margin-bottom:20px;border-radius:20px;border-left:6px solid #a8e6cf;box-shadow:0 5px 20px rgba(0,0,0,0.08);position:relative;}
        .visit-date {font-weight:bold;color:#ff9a9e;font-size:clamp(16px,4vw,20px);margin-bottom:15px;}
        .visit-delete {position:absolute;top:15px;right:15px;background:#ff6b81;color:white;border:none;border-radius:50%;width:35px;height:35px;font-size:16px;cursor:pointer;}
        .visit-delete:hover {background:#ff4757;}
        .visit-delete:active {transform:scale(0.95);}

        .client-actions {margin-top:30px;}
        .client-actions .btn {width:48%;margin:0 1%;margin-bottom:10px;}

        @media (max-width:480px) {
            body {padding:8px;}
            .content, .modal-content {padding:20px 15px;}
            .client-card {padding:20px;}
            .client-actions .btn {width:100%;margin:5px 0;}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥</h1>
        <!-- ‚úÖ –ü–û–î–ó–ê–ì–û–õ–û–í–û–ö –£–ë–†–ê–ù -->
    </div>

    <!-- ‚úÖ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –£–ë–†–ê–ù–ê -->
    <div id="dashboard" class="dashboard content">
        <div class="btn-grid">
            <button class="btn" onclick="newClient()">üë§ –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</button>
        </div>

        <div class="client-list" id="clientList">
            <div class="no-clients">
                <h3>üë• –ö–ª–∏–µ–Ω—Ç—ã</h3>
                <p>–ö–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ!</p>
            </div>
        </div>
    </div>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
<div id="clientModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeClientModal()">&times;</span>
        <h2 id="clientModalTitle">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h2>
        <form id="clientForm">
            <div class="form-row">
                <div class="form-group">
                    <label>üë§ –§–ò–û</label>
                    <input type="text" id="clientName" required>
                </div>
                <div class="form-group">
                    <label>üìû –¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="clientPhone" required>
                </div>
            </div>
            <div class="form-group">
                <label>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                <textarea id="clientExtra" rows="3" placeholder="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –∞–ª–ª–µ—Ä–≥–∏–∏..."></textarea>
            </div>
            <div style="text-align:right;">
                <button type="button" class="btn-small btn-danger" id="deleteClientBtn" onclick="deleteCurrentClient()" style="display:none;">üóëÔ∏è</button>
                <button type="button" class="btn-small" onclick="closeClientModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>

        <div class="client-actions" id="clientActions" style="display:none;">
            <button class="btn" onclick="newVisitFromClient()">‚ûï –ù–æ–≤—ã–π –≤–∏–∑–∏—Ç</button>
            <button class="btn btn-danger" onclick="deleteCurrentClient()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
        </div>

        <div id="clientVisitHistory" style="margin-top:30px;"></div>
    </div>
</div>

<div id="visitModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeVisitModal()">&times;</span>
        <h2 id="visitTitle">–ù–æ–≤—ã–π –≤–∏–∑–∏—Ç</h2>
        <form id="visitForm">
            <div class="form-group">
                <label>üìÖ –î–∞—Ç–∞</label>
                <input type="date" id="visitDate">
            </div>
            <div class="form-group">
                <label>üíâ –ü—Ä–µ–ø–∞—Ä–∞—Ç</label>
                <select id="visitPrep"></select>
                <div class="new-item-section">
                    <div class="new-input-row">
                        <input type="text" id="newPrepInput" placeholder="–ù–æ–≤—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç">
                        <button type="button" class="btn-small btn-new" onclick="addPrep()">‚ûï</button>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>üìç –ó–æ–Ω–∞</label>
                <select id="visitZone"></select>
                <div class="new-item-section">
                    <div class="new-input-row">
                        <input type="text" id="newZoneInput" placeholder="–ù–æ–≤–∞—è –∑–æ–Ω–∞">
                        <button type="button" class="btn-small btn-new" onclick="addZone()">‚ûï</button>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>üí∞ –¶–µ–Ω–∞</label>
                    <input type="number" id="visitPrice" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <label>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                <textarea id="visitComment" rows="4"></textarea>
            </div>
            <div style="text-align:right;">
                <button type="button" class="btn-small" onclick="closeVisitModal()">‚ùå</button>
                <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script>
let currentClientId = null;
let clients = JSON.parse(localStorage.getItem('clients')) || [];
let visits = JSON.parse(localStorage.getItem('visits')) || [];
let preparations = JSON.parse(localStorage.getItem('preparations')) || ['–ë–æ—Ç–æ–∫—Å','–§–∏–ª–ª–µ—Ä—ã','–ú–µ–∑–æ—Ç–µ—Ä–∞–ø–∏—è','–ü–∏–ª–∏–Ω–≥','–õ–∞–∑–µ—Ä'];
let zones = JSON.parse(localStorage.getItem('zones')) || ['–õ–∏—Ü–æ','–®–µ—è','–î–µ–∫–æ–ª—å—Ç–µ','–ì–ª–∞–∑–∞','–†—É–∫–∏'];

// ‚úÖ –î–ê–ù–ù–´–ï –ì–†–£–ó–Ø–¢–°–Ø –°–†–ê–ó–£ - –ë–ï–ó –õ–û–ì–ò–ù–ê
document.addEventListener('DOMContentLoaded', () => {
    loadClientsList();
    loadLists();
});

// ‚úÖ –ù–û–í–´–ô –ö–õ–ò–ï–ù–¢
function newClient() {
    currentClientId = null;
    document.getElementById('clientModalTitle').textContent = '–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç';
    document.getElementById('clientForm').reset();
    document.getElementById('deleteClientBtn').style.display = 'none';
    document.getElementById('clientActions').style.display = 'none';
    document.getElementById('clientVisitHistory').innerHTML = '';
    document.getElementById('clientModal').style.display = 'block';
}

// ‚úÖ –°–ü–ò–°–û–ö –ö–õ–ò–ï–ù–¢–û–í
function loadClientsList() {
    const container = document.getElementById('clientList');

    if (clients.length === 0) {
        container.innerHTML = '<div class="no-clients"><h3>üë• –ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</h3><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ!</p></div>';
        return;
    }

    container.innerHTML = clients.map(client => {
        const visitCount = visits.filter(v => v.client_id === client.id).length;
        return `
            <div class="client-card" onclick="openClientCard(${client.id})">
                <div class="client-avatar">${client.name.charAt(0).toUpperCase()}</div>
                <div class="client-info">
                    <div class="client-name">${client.name}</div>
                    <div class="client-phone">${client.phone}</div>
                    <div class="client-visits">${visitCount} –≤–∏–∑–∏—Ç${visitCount !== 1 ? '–æ–≤' : ''}</div>
                </div>
            </div>
        `;
    }).join('');
}

// ‚úÖ –û–¢–ö–†–´–¢–ò–ï –ö–ê–†–¢–û–ß–ö–ò –ö–õ–ò–ï–ù–¢–ê
function openClientCard(clientId) {
    currentClientId = clientId;
    const client = clients.find(c => c.id === clientId);

    document.getElementById('clientName').value = client.name;
    document.getElementById('clientPhone').value = client.phone;
    document.getElementById('clientExtra').value = client.extra_info || '';
    document.getElementById('clientModalTitle').textContent = `–ö–ª–∏–µ–Ω—Ç: ${client.name}`;
    document.getElementById('deleteClientBtn').style.display = 'inline-block';
    document.getElementById('clientActions').style.display = 'flex';

    loadClientHistory(clientId);
    document.getElementById('clientModal').style.display = 'block';
}

// ‚úÖ –ò–°–¢–û–†–ò–Ø –° –£–î–ê–õ–ï–ù–ò–ï–ú
function loadClientHistory(clientId) {
    const clientVisits = visits
        .filter(v => v.client_id === clientId)
        .sort((a, b) => new Date(b.date) - new Date(a.date));

    const historyHtml = clientVisits.map(v => `
        <div class="visit-item">
            <button class="visit-delete" onclick="deleteVisit(${v.id});event.stopPropagation();">√ó</button>
            <div class="visit-date">${new Date(v.date).toLocaleDateString('ru-RU')}</div>
            <div>
                <strong>üíâ ${v.preparation}</strong> | 
                <strong>üìç ${v.zone}</strong>
                ${v.price ? `<br>üí∞ ${v.price} ‚ÇΩ` : ''}
                ${v.comment ? `<br><em>${v.comment}</em>` : ''}
            </div>
        </div>
    `).join('') || '<p style="text-align:center;color:#999;padding:30px 0;">–ù–µ—Ç –≤–∏–∑–∏—Ç–æ–≤</p>';

    document.getElementById('clientVisitHistory').innerHTML = `
        <h3 style="margin-bottom:20px;">üìã –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ (${clientVisits.length})</h3>
        ${historyHtml}
    `;
}

// ‚úÖ –£–î–ê–õ–ï–ù–ò–ï –í–ò–ó–ò–¢–ê
function deleteVisit(visitId) {
    visits = visits.filter(v => v.id !== visitId);
    saveData();
    loadClientHistory(currentClientId);
}

// –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
function closeClientModal() {document.getElementById('clientModal').style.display = 'none';}
function closeVisitModal() {
    document.getElementById('visitModal').style.display = 'none';
    document.getElementById('visitForm').reset();
    document.getElementById('visitDate').value = new Date().toISOString().split('T')[0];
}

function newVisitFromClient() {
    const client = clients.find(c => c.id === currentClientId);
    document.getElementById('visitTitle').textContent = `–í–∏–∑–∏—Ç –¥–ª—è ${client.name}`;
    closeClientModal();
    document.getElementById('visitModal').style.display = 'block';
}

function loadLists() {
    document.getElementById('visitPrep').innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>' + preparations.map(p => `<option>${p}</option>`).join('');
    document.getElementById('visitZone').innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>' + zones.map(z => `<option>${z}</option>`).join('');
}

function addPrep() {
    const newPrep = document.getElementById('newPrepInput').value.trim();
    if (newPrep && !preparations.includes(newPrep)) {
        preparations.push(newPrep);
        saveData();
        loadLists();
        document.getElementById('newPrepInput').value = '';
    }
}

function addZone() {
    const newZone = document.getElementById('newZoneInput').value.trim();
    if (newZone && !zones.includes(newZone)) {
        zones.push(newZone);
        saveData();
        loadLists();
        document.getElementById('newZoneInput').value = '';
    }
}

function saveData() {
    localStorage.setItem('clients', JSON.stringify(clients));
    localStorage.setItem('visits', JSON.stringify(visits));
    localStorage.setItem('preparations', JSON.stringify(preparations));
    localStorage.setItem('zones', JSON.stringify(zones));
}

// –§–æ—Ä–º–∞ –∫–ª–∏–µ–Ω—Ç–∞
document.getElementById('clientForm').addEventListener('submit', e => {
    e.preventDefault();

    const clientData = {
        id: currentClientId || Date.now(),
        name: document.getElementById('clientName').value.trim(),
        phone: document.getElementById('clientPhone').value.trim(),
        extra_info: document.getElementById('clientExtra').value.trim()
    };

    if (!clientData.name || !clientData.phone) return;

    if (currentClientId) {
        const index = clients.findIndex(c => c.id === currentClientId);
        clients[index] = clientData;
    } else {
        clients.push(clientData);
    }

    saveData();
    loadClientsList();
    closeClientModal();
});

// –§–æ—Ä–º–∞ –≤–∏–∑–∏—Ç–∞
document.getElementById('visitForm').addEventListener('submit', e => {
    e.preventDefault();

    const prep = document.getElementById('visitPrep').value.trim() || document.getElementById('newPrepInput').value.trim();
    const zone = document.getElementById('visitZone').value.trim() || document.getElementById('newZoneInput').value.trim();

    if (!prep || !zone) return;

    visits.push({
        id: Date.now(),
        client_id: currentClientId,
        date: document.getElementById('visitDate').value,
        preparation: prep,
        zone: zone,
        price: document.getElementById('visitPrice').value || '',
        comment: document.getElementById('visitComment').value.trim()
    });

    saveData();
    closeVisitModal();
    loadClientsList();
});

// –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
function deleteCurrentClient() {
    if (confirm('üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏ –≤—Å–µ –≤–∏–∑–∏—Ç—ã?')) {
        clients = clients.filter(c => c.id !== currentClientId);
        visits = visits.filter(v => v.client_id !== currentClientId);
        saveData();
        loadClientsList();
        closeClientModal();
    }
}

// –ö–ª–∏–∫ –∑–∞ –º–æ–¥–∞–ª–∫–æ–π
window.onclick = e => {
    if (e.target.classList.contains('modal')) e.target.style.display = 'none';
};
</script>
</body>
</html>
